<source>
   @type forward
   port 24224
   bind 0.0.0.0
   source_hostname_key fluent_client
</source>

<source>
   @type syslog
   port 5140
   bind 0.0.0.0
   tag system
</source>

########## Matching Rules ##########
<match acho.php-fpm.**>
   @type copy
   <store>
      @type file
      path /var/log/fluent/acho/php-fpm.%Y-%m-%d
      append true
      compress gzip
      <buffer time>
         @type file
         path /var/log/fluent/buffer/php-fpm
         timekey 1d
         timekey_wait 1m
         flush_mode interval
         flush_interval 3
      </buffer>
   </store>
   <store>
      @type azure-loganalytics
      customer_id <LOGANALYTICS_CUSTOMER_ID>
      shared_key <LOGANALYTICS_SHARED_KEY>
      log_type AchoPhp
      add_tag_field true
      time_format %Y-%m-%d %H:%M:%S
      <buffer time>
         timekey 1h
         timekey_wait 1m
         flush_mode interval
         flush_interval 10
         slow_flush_log_threshold 60
         retry_max_times 10
         retry_wait 10
      </buffer>
   </store>
</match>
<match acho.nginx.**>
   @type copy
   <store>
      @type file
      path /var/log/fluent/acho/nginx.%Y-%m-%d
      append true
      compress gzip
      <buffer time>
         @type file
         path /var/log/fluent/buffer/nginx
         timekey 1d
         timekey_wait 1m
         flush_mode interval
         flush_interval 3
      </buffer>
   </store>
   <store>
      @type azure-loganalytics
      customer_id <LOGANALYTICS_CUSTOMER_ID>
      shared_key <LOGANALYTICS_SHARED_KEY>
      log_type AchoNginx
      add_tag_field true
      time_format %Y-%m-%d %H:%M:%S
      <buffer time>
         timekey 1h
         timekey_wait 1m
         flush_mode interval
         flush_interval 10
         slow_flush_log_threshold 60
         retry_max_times 10
         retry_wait 10
      </buffer>
   </store>
</match>
<match acho.apps.**>
   @type copy
   <store>
      @type file
      path /var/log/fluent/acho/apps.%Y-%m-%d
      append true
      compress gzip
      <buffer time>
         @type file
         path /var/log/fluent/buffer/apps
         timekey 1d
         timekey_wait 1m
         flush_mode interval
         flush_interval 3
      </buffer>
   </store>
   <store>
      @type azure-loganalytics
      customer_id <LOGANALYTICS_CUSTOMER_ID>
      shared_key <LOGANALYTICS_SHARED_KEY>
      log_type AchoApp
      add_tag_field true
      time_format %Y-%m-%d %H:%M:%S
      <buffer time>
         timekey 1h
         timekey_wait 1m
         flush_mode interval
         flush_interval 10
         slow_flush_log_threshold 60
         retry_max_times 10
         retry_wait 10
      </buffer>
   </store>
</match>
<match acho.apps-java-gc.**>
   @type copy
   <store>
      @type file
      path /var/log/fluent/acho/acho-java-gc.%Y-%m-%d
      append true
      compress gzip
      <buffer time>
         @type file
         path /var/log/fluent/buffer/acho-java-gc
         timekey 1d
         timekey_wait 1m
         flush_mode interval
         flush_interval 3
      </buffer>
   </store>
   <store>
      @type azure-loganalytics
      customer_id <LOGANALYTICS_CUSTOMER_ID>
      shared_key <LOGANALYTICS_SHARED_KEY>
      log_type AchoJavaGC
      add_tag_field true
      time_format %Y-%m-%d %H:%M:%S
      <buffer time>
         @type file
         path /var/log/fluent/buffer/acho-java
         timekey 1d
         timekey_wait 1m
         flush_mode interval
         flush_interval 3
         slow_flush_log_threshold 60
         retry_max_times 10
         retry_wait 10
      </buffer>
   </store>
</match>
<match acho.apps-java.**>
   @type copy
   <store>
      @type file
      path /var/log/fluent/acho/acho-java.%Y-%m-%d
      append true
      compress gzip
      <buffer time>
         @type file
         path /var/log/fluent/buffer/acho-java
         timekey 1d
         timekey_wait 1m
         flush_mode interval
         flush_interval 3
      </buffer>
   </store>
   <store>
      @type azure-loganalytics
      customer_id <LOGANALYTICS_CUSTOMER_ID>
      shared_key <LOGANALYTICS_SHARED_KEY>
      log_type AchoJava
      add_tag_field true
      time_format %Y-%m-%d %H:%M:%S
      <buffer time>
         timekey 1h
         timekey_wait 1m
         flush_mode interval
         flush_interval 10
         slow_flush_log_threshold 60
         retry_max_times 10
         retry_wait 10
      </buffer>
   </store>
</match>

<match acho.**>
   @type copy
   <store>
      @type file
      path /var/log/fluent/acho/other.%Y-%m-%d
      append true
      compress gzip
      <buffer time>
         @type file
         path /var/log/fluent/buffer/acho
         timekey 1d
         timekey_wait 1m
         flush_mode interval
         flush_interval 3
      </buffer>
   </store>
   <store>
      @type azure-loganalytics
      customer_id <LOGANALYTICS_CUSTOMER_ID>
      shared_key <LOGANALYTICS_SHARED_KEY>
      log_type AchoOthers
      add_tag_field true
      time_format %Y-%m-%d %H:%M:%S
      <buffer time>
         timekey 1h
         timekey_wait 1m
         flush_mode interval
         flush_interval 10
         slow_flush_log_threshold 60
         retry_max_times 10
         retry_wait 10
      </buffer>
   </store>
</match>

<match **>
   @type copy
   <store>
      @type file
      path /var/log/fluent/other.%Y-%m-%d
      append true
      compress gzip
      <buffer time>
         @type file
         path /var/log/fluent/buffer
         timekey 1d
         timekey_wait 1m
         flush_mode interval
         flush_interval 3
      </buffer>
   </store>
   <store>
      @type azure-loganalytics
      customer_id <LOGANALYTICS_CUSTOMER_ID>
      shared_key <LOGANALYTICS_SHARED_KEY>
      log_type Others
      add_tag_field true
      time_format %Y-%m-%d %H:%M:%S
      <buffer time>
         timekey 1h
         timekey_wait 1m
         flush_mode interval
         flush_interval 10
         slow_flush_log_threshold 60
         retry_max_times 10
         retry_wait 10
      </buffer>
   </store>
</match>